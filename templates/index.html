<!DOCTYPE html>
<html>
<head>
    <title>CleanNow+ | Citizen Portal</title>

    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background:
                radial-gradient(circle at top left, #c8e6c9, transparent 45%),
                radial-gradient(circle at bottom right, #a5d6a7, transparent 45%),
                linear-gradient(135deg,#e8f5e9,#ffffff);
            min-height: 100vh;
        }

        header {
            background: linear-gradient(90deg,#1b5e20,#43a047);
            color: white;
            padding: 26px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.25);
        }

        header h1 {
            margin: 0;
            font-size: 30px;
        }

        header p {
            margin: 6px 0 0;
            font-size: 15px;
            opacity: 0.95;
        }

        .container {
            display: flex;
            justify-content: center;
            padding: 50px 20px;
        }

        .card {
            background: rgba(255,255,255,0.95);
            width: 480px;
            padding: 34px;
            border-radius: 22px;
            box-shadow: 0 20px 45px rgba(0,0,0,0.15);
            animation: fadeIn 0.8s ease;
        }

        h2 {
            text-align: center;
            color: #2e7d32;
        }

        label {
            font-weight: 600;
            display: block;
            margin-top: 16px;
        }

        select, input, button {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            font-size: 15px;
            border-radius: 10px;
        }

        input, select {
            border: 1px solid #ccc;
        }

        button {
            border: none;
            cursor: pointer;
            font-weight: bold;
        }

        .primary {
            background: linear-gradient(90deg,#2e7d32,#43a047);
            color: white;
            margin-top: 20px;
        }

        .alt-btn {
            background: linear-gradient(90deg,#1565c0,#1e88e5);
            color: white;
            margin-top: 10px;
        }

        .info-btn {
            background: linear-gradient(90deg,#6a1b9a,#8e24aa);
            color: white;
            margin-top: 12px;
        }

        .msg {
            text-align: center;
            margin-top: 14px;
            font-weight: bold;
        }

        footer {
            text-align: center;
            padding: 18px;
            color: #555;
        }

        /* ===== INFO POPUP ===== */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .popup {
            background: white;
            width: 520px;
            max-width: 90%;
            padding: 30px;
            border-radius: 18px;
            box-shadow: 0 25px 60px rgba(0,0,0,0.3);
            animation: zoomIn 0.4s ease;
        }

        .popup h3 {
            color: #2e7d32;
            margin-top: 0;
        }

        .popup ul {
            padding-left: 18px;
            font-size: 15px;
        }

        .popup li {
            margin-bottom: 10px;
        }

        .close {
            background: #c62828;
            color: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-top: 15px;
            cursor: pointer;
            font-weight: bold;
        }

        @keyframes zoomIn {
            from {transform:scale(0.85); opacity:0;}
            to {transform:scale(1); opacity:1;}
        }

        @keyframes fadeIn {
            from {opacity:0; transform:translateY(20px);}
            to {opacity:1; transform:translateY(0);}
        }
    </style>
</head>

<body>

<header>
    <h1>‚ôªÔ∏è CleanNow+</h1>
    <p>Smart Waste Reporting & Municipal Action Platform</p>
</header>

<div class="container">
    <div class="card">

        <h2>üì∏ Report Waste</h2>

        <label>Waste Type</label>
        <select id="wasteType">
            <option>Garbage</option>
            <option>Plastic</option>
            <option>Organic</option>
            <option>E-Waste</option>
            <option>Construction Waste</option>
        </select>

        <label>Upload Image</label>
        <input type="file" id="imageInput" accept="image/*">

        <button class="primary" onclick="submitReport()">üöÄ Submit Report</button>

        <button class="alt-btn" onclick="goToStatus()">üîç Track My Reports</button>

        <button class="info-btn" onclick="openGuide()">‚ÑπÔ∏è How This System Works</button>

        <div class="msg" id="msg"></div>

    </div>
</div>

<footer>
    Hackathon Demo System ‚Ä¢ End-to-End Civic Workflow üöÄ
</footer>

<!-- ===== GUIDE POPUP ===== -->
<div class="overlay" id="guide">
    <div class="popup">
        <h3>üß≠ Demo & Usage Guide (For Evaluators)</h3>

        <ul>
            <li><b>Citizen:</b> Upload waste photo ‚Üí submit ‚Üí track status.</li>
            <li><b>Worker Panel:</b> <br>
                URL: <code>/worker</code><br>
                Upload ‚Äúafter cleaning‚Äù image.
            </li>
            <li><b>Admin Panel:</b> <br>
                URL: <code>/admin</code><br>
                Username: <b>admin</b><br>
                Password: <b>admin</b>
            </li>
            <li><b>Workflow:</b> Citizen ‚Üí Worker ‚Üí Admin ‚Üí Feedback</li>
            <li>Each citizen sees <b>only their own reports</b>.</li>
            <li>Completion status + feedback visible to admin.</li>
        </ul>

        <div class="close" onclick="closeGuide()">Close</div>
    </div>
</div>

<script>
if (!localStorage.getItem("cleannow_user")) {
    localStorage.setItem(
        "cleannow_user",
        "user_" + Math.random().toString(36).substr(2, 9)
    );
}

function goToStatus() {
    const uid = localStorage.getItem("cleannow_user");
    window.location.href = "/status?user=" + uid;
}

function submitReport() {
    const image = document.getElementById("imageInput").files[0];
    const waste = document.getElementById("wasteType").value;
    const msg = document.getElementById("msg");
    const userId = localStorage.getItem("cleannow_user");

    if (!image) {
        msg.innerHTML = "‚ùå Please upload an image";
        return;
    }

    navigator.geolocation.getCurrentPosition(pos => {
        const fd = new FormData();
        fd.append("user_id", userId);
        fd.append("waste_type", waste);
        fd.append("latitude", pos.coords.latitude);
        fd.append("longitude", pos.coords.longitude);
        fd.append("before_image", image);

        fetch("/submit", { method: "POST", body: fd })
        .then(res => window.location.href = res.url);
    });
}

function openGuide() {
    document.getElementById("guide").style.display = "flex";
}

function closeGuide() {
    document.getElementById("guide").style.display = "none";
}
</script>

</body>
</html>
